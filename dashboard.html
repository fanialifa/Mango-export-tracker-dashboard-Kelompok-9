<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Mango Export Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding-bottom: 2rem;
            color: #2d3748;
        }

        .navbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .navbar h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
        }

        .navbar h1 span {
            color: #ed8936;
        }

        .navbar nav a {
            color: #4a5568;
            text-decoration: none;
            margin-left: 2rem;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .navbar nav a:hover {
            color: #ed8936;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
        }

        .header h2 {
            font-size: 2rem;
            color: #1a202c;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header h2 span {
            color: #ed8936;
        }

        .header p {
            color: #718096;
            font-size: 1rem;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            border-top: 4px solid #ed8936;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(237, 137, 54, 0.15);
        }

        .kpi-card h3 {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .kpi-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ed8936;
            margin-bottom: 0.5rem;
        }

        .kpi-card .change {
            color: #48bb78;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .filters h3 {
            color: #ed8936;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group select {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: white;
            font-family: inherit;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #ed8936;
            box-shadow: 0 0 0 3px rgba(237, 137, 54, 0.1);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .chart-card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        .chart-card h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container canvas {
            max-height: 250px;
        }

        .powerbi-section {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .powerbi-section h3 {
            color: #ed8936;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .powerbi-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .powerbi-tab {
            padding: 0.75rem 1.5rem;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            color: #4a5568;
        }

        .powerbi-tab.active {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
            border-color: #ed8936;
        }

        .powerbi-iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 10px;
        }

        footer {
            background: white;
            padding: 3rem 2rem;
            text-align: center;
            color: #718096;
            margin-top: 3rem;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.05);
            border-radius: 16px;
        }

        footer p {
            margin: 0.5rem 0;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .navbar nav a {
                margin-left: 1rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>ü•≠ Mango <span>Export Dashboard Analytics</span></h1>
        <nav>
            <a href="index.html#home">Home</a>
            <a href="index.html#tracking">Tracking</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="index.html#team">Team</a>
        </nav>
    </nav>

    <div class="container">
        <div class="header">
            <h2>üìä Analytics <span>Dashboard</span></h2>
            <p>Real-time analisis dari 2000+ batch mangga ekspor Indonesia</p>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <h3>Total Batches</h3>
                <div class="value" id="kpiTotal">-</div>
                <div class="change">‚úì All time</div>
            </div>
            <div class="kpi-card">
                <h3>Total Weight</h3>
                <div class="value" id="kpiWeight">-</div>
                <div class="change">Tons</div>
            </div>
            <div class="kpi-card">
                <h3>Delivered</h3>
                <div class="value" id="kpiDelivered">-</div>
                <div class="change" id="kpiDeliveredPercent">Success rate</div>
            </div>
            <div class="kpi-card">
                <h3>Total Revenue</h3>
                <div class="value" id="kpiRevenue">-</div>
                <div class="change">USD</div>
            </div>
        </div>

        <div class="filters">
            <h3>üîç Filters</h3>
            <div class="filter-group">
                <select id="filterProvince" onchange="applyFilters()">
                    <option value="">All Provinces</option>
                </select>
                <select id="filterStatus" onchange="applyFilters()">
                    <option value="">All Status</option>
                </select>
                <select id="filterGrade" onchange="applyFilters()">
                    <option value="">All Grades</option>
                </select>
                <select id="filterDest" onchange="applyFilters()">
                    <option value="">All Destinations</option>
                </select>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìç Distribution by Province</h3>
                <div class="chart-container">
                    <canvas id="provinceChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>üì¶ Status Breakdown</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>üåç Export Destinations</h3>
                <div class="chart-container">
                    <canvas id="destChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>‚≠ê Quality Grades</h3>
                <div class="chart-container">
                    <canvas id="gradeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="powerbi-section" id="powerbi">
            <h3>üìà Power BI Reports (Real-time)</h3>
            <p style="color: #718096; margin-bottom: 1rem;">Data real-time dari Power BI Service - integrasi dengan database utama</p>
            <div class="powerbi-tabs">
                <button class="powerbi-tab active" onclick="showPowerBI('all')">All Overview</button>
                <button class="powerbi-tab" onclick="showPowerBI('export')">Total Exported</button>
                <button class="powerbi-tab" onclick="showPowerBI('delivery')">Delivery Rate</button>
                <button class="powerbi-tab" onclick="showPowerBI('revenue')">Revenue</button>
                <button class="powerbi-tab" onclick="showPowerBI('forecast')">Forecast</button>
                <button class="powerbi-tab" onclick="showPowerBI('quality')">Quality Grade</button>
                <button class="powerbi-tab" onclick="showPowerBI('weight')">Export Weight</button>
            </div>
            <iframe id="powerbiFrame" class="powerbi-iframe" 
                    src="https://app.powerbi.com/reportEmbed?reportId=2cec03a5-f0c9-43d3-a629-b733678bd63a&autoAuth=true&ctid=fedd5298-8e66-45f1-b321-fd38ad0ff722" 
                    frameborder="0" allowFullScreen="true"></iframe>
        </div>
    </div>

    <footer>
        <p style="font-size: 1.1rem; color: #2d3748; font-weight: 600;">ü•≠ Mango Export Dashboard Indonesia</p>
        <p style="margin-top: 0.75rem;">Supporting Indonesian Farmers | Quality Export | Built with ‚ù§Ô∏è by Kelompok 9 TIK</p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">¬© 2025 All Rights Reserved</p>
    </footer>

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";

        // TODO: Ganti dengan config dari Firebase Console (Project Settings > General > Your apps)
        const firebaseConfig = {
            apiKey: "AIzaSyAIDp4zTKgWTmSP7OJAwtvZsBXGLMnkVSs",
            authDomain: "tik-kelompok-9.firebaseapp.com",
            projectId: "tik-kelompok-9",
            storageBucket: "tik-kelompok-9.firebasestorage.app",
            messagingSenderId: "71767393370",
            appId: "1:71767393370:web:7b52a2f558365180e90463"
        };

        // Initialize Firebase
        const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
        window.firebaseApp = app;

        console.log("‚úÖ Firebase initialized successfully!");
    </script>

    <!-- Batch Data -->
    <script src="batches_array.js"></script>

    <!-- Dashboard Logic -->
    <script>
        let charts = {};
        let filteredData = [];

        // Mango color palette (soft, matching index)
        const orangePalette = ['#ed8936', '#dd6b20', '#f6ad55', '#fbd38d', '#fed7aa', '#fbb6ce'];

        window.addEventListener('load', () => {
            filteredData = [...batchesArray];
            initializeFilters();
            updateKPIs();
            createCharts();
        });

        function initializeFilters() {
            const provinces = getUniqueValues('province');
            const statuses = getUniqueValues('status');
            const grades = getUniqueValues('grade');
            const destinations = getUniqueValues('dest');

            populateSelect('filterProvince', provinces);
            populateSelect('filterStatus', statuses);
            populateSelect('filterGrade', grades);
            populateSelect('filterDest', destinations);
        }

        function populateSelect(id, values) {
            const select = document.getElementById(id);
            values.sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                select.appendChild(option);
            });
        }

        function getUniqueValues(field) {
            return [...new Set(batchesArray.map(b => b[field]))];
        }

        function applyFilters() {
            const province = document.getElementById('filterProvince').value;
            const status = document.getElementById('filterStatus').value;
            const grade = document.getElementById('filterGrade').value;
            const dest = document.getElementById('filterDest').value;

            filteredData = batchesArray.filter(batch => {
                return (!province || batch.province === province) &&
                       (!status || batch.status === status) &&
                       (!grade || batch.grade === grade) &&
                       (!dest || batch.dest === dest);
            });

            updateKPIs();
            updateCharts();
        }

        function updateKPIs() {
            const total = filteredData.length;
            const totalWeight = filteredData.reduce((sum, b) => sum + parseFloat(b.weight || 0), 0);
            const delivered = filteredData.filter(b => b.status === 'Delivered').length;
            const totalRevenue = filteredData.reduce((sum, b) => {
                const weight = parseFloat(b.weight || 0);
                const price = parseFloat(b.price || 0);
                return sum + (weight * price);
            }, 0);

            document.getElementById('kpiTotal').textContent = total.toLocaleString();
            document.getElementById('kpiWeight').textContent = (totalWeight / 1000).toFixed(1);
            document.getElementById('kpiDelivered').textContent = delivered.toLocaleString();
            document.getElementById('kpiDeliveredPercent').textContent = `${(delivered / total * 100).toFixed(1)}% success rate`;
            document.getElementById('kpiRevenue').textContent = `$${(totalRevenue / 1000).toFixed(1)}K`;
        }

        function createCharts() {
            createProvinceChart();
            createStatusChart();
            createDestChart();
            createGradeChart();
        }

        function updateCharts() {
            Object.values(charts).forEach(chart => chart.destroy());
            createCharts();
        }

        function createProvinceChart() {
            const ctx = document.getElementById('provinceChart');
            const data = countByFieldFiltered('province');
            charts.province = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Batches',
                        data: Object.values(data),
                        backgroundColor: '#ed8936',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function createStatusChart() {
            const ctx = document.getElementById('statusChart');
            const data = countByFieldFiltered('status');
            charts.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: orangePalette
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function createDestChart() {
            const ctx = document.getElementById('destChart');
            const data = countByFieldFiltered('dest');
            charts.dest = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Batches',
                        data: Object.values(data),
                        backgroundColor: '#dd6b20',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        function createGradeChart() {
            const ctx = document.getElementById('gradeChart');
            const data = countByFieldFiltered('grade');
            charts.grade = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: ['#48bb78', '#f6ad55', '#fc8181']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function countByFieldFiltered(field) {
            const counts = {};
            filteredData.forEach(b => {
                const val = b[field];
                counts[val] = (counts[val] || 0) + 1;
            });
            return counts;
        }

        function showPowerBI(type) {
            document.querySelectorAll('.powerbi-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            const baseUrl = 'https://app.powerbi.com/reportEmbed?reportId=2cec03a5-f0c9-43d3-a629-b733678bd63a&autoAuth=true&ctid=fedd5298-8e66-45f1-b321-fd38ad0ff722';
            document.getElementById('powerbiFrame').src = baseUrl;
        }
    </script>
</body>

</html>
